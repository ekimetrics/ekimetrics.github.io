"use strict";(self.webpackChunkeki_lab=self.webpackChunkeki_lab||[]).push([[9182],{4232:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy1-3ff5f56d09525d8a6eaa1a7d28c03d2d.jpg"},8794:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy3-7baddac8cf539257b25de03c805ac72b.jpg"},28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>s});var i=o(96540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},29481:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy4-9ce5fb1726645caa869d8457f9ac1076.jpg"},34235:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy6-1866d64b76ae518722783bdb6ae673f5.jpg"},46850:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/dash-deployment-9915c614706ee5305450f6d12f8bce23.jpg"},51533:e=>{e.exports=JSON.parse('{"permalink":"/blog/dash-deployment","source":"@site/blog/2021-10-16-dash-deployment.md","title":"Deploying a Python Dash application for beginners","description":"Learn the basics of application deployment from simple examples on Heroku to creating Docker containers","date":"2021-10-16T00:00:00.000Z","tags":[{"inline":true,"label":"Industrialization","permalink":"/blog/tags/industrialization"}],"readingTime":4.7,"hasTruncateMarker":true,"authors":[{"name":"Th\xe9o Alves Da Costa","title":"Head of AI For Sustainability","url":"mailto:inno@ekimetrics.com","key":"theo.alves","page":null}],"frontMatter":{"slug":"dash-deployment","title":"Deploying a Python Dash application for beginners","authors":["theo.alves"],"header_image_url":"img/blog/dash-deployment.jpg","image":"img/blog/dash-deployment.jpg","tags":["Industrialization"],"description":"Learn the basics of application deployment from simple examples on Heroku to creating Docker containers","keywords":["Data Science","EkiLab","Ekimetrics","Eki.Lab","Eki","Machine Learning","Artificial Intelligence","Industrialization","Docker","Heroku","Python","Dash"]},"unlisted":false,"prevItem":{"title":"Solving the Traveling Salesman Problem with Reinforcement Learning","permalink":"/blog/2021/11/03/tsp"},"nextItem":{"title":"Welcome to the new Ekimetrics Tech website!","permalink":"/blog/welcome"}}')},72631:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy2-27b1b4e8a48326566a151173de137787.jpg"},77414:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var i=o(51533),t=o(74848),a=o(28453);const r={slug:"dash-deployment",title:"Deploying a Python Dash application for beginners",authors:["theo.alves"],header_image_url:"img/blog/dash-deployment.jpg",image:"img/blog/dash-deployment.jpg",tags:["Industrialization"],description:"Learn the basics of application deployment from simple examples on Heroku to creating Docker containers",keywords:["Data Science","EkiLab","Ekimetrics","Eki.Lab","Eki","Machine Learning","Artificial Intelligence","Industrialization","Docker","Heroku","Python","Dash"]},s=void 0,l={authorsImageUrls:[void 0]},d=[{value:"Creating a Dash application",id:"creating-a-dash-application",level:2},{value:"Deploying your Dash application",id:"deploying-your-dash-application",level:2},{value:"Deploying on Heroku from GitHub",id:"deploying-on-heroku-from-github",level:3},{value:"Problems you can encounter",id:"problems-you-can-encounter",level:4},{value:"What Heroku is doing under the hood",id:"what-heroku-is-doing-under-the-hood",level:4},{value:"Deploying with Docker",id:"deploying-with-docker",level:3},{value:"Going further",id:"going-further",level:2},{value:"Adding databases",id:"adding-databases",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{align:"center",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"screenshot-app ",src:o(46850).A+"",width:"1050",height:"700"})})}),"\n",(0,t.jsx)(n.h2,{id:"creating-a-dash-application",children:"Creating a Dash application"}),"\n",(0,t.jsxs)(n.p,{children:["Before deployment, the first step if of course to create your own application. ",(0,t.jsx)("br",{}),"\nYou can follow the guidelines in Dash official documentation ",(0,t.jsx)(n.a,{href:"https://dash.plotly.com/installation",children:"https://dash.plotly.com/installation"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://dash-gallery.plotly.host/Manager/apps_data/dash-oil-and-gas/thumbnail_0a718df0-9ce7-11e9-8982-0242ac11004a.png",alt:""})}),"\n",(0,t.jsx)(n.h2,{id:"deploying-your-dash-application",children:"Deploying your Dash application"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://dash.plotly.com/deployment",children:"https://dash.plotly.com/deployment"}),"\nDash/Plotly offers a paid service to super easily deploy and manager your applications. Yet as most of it is open source, and you may want a simple thing for a prototype, you can simply deploy it in your own server."]}),"\n",(0,t.jsx)(n.p,{children:"Then you have several options:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Beginners - Deploy it on a simple Heroku server"}),"\n",(0,t.jsx)(n.li,{children:"Advanced - Deploy it on a cloud server (AWS, GCP, Azure) with docker containers"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"deploying-on-heroku-from-github",children:"Deploying on Heroku from GitHub"}),"\n",(0,t.jsx)(n.p,{children:"Heroku is the most simple server provider. It's even more simpleYou can create and deploy apps for free in just a few minutes. That's what we are going to do here :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create your dash app, eg ",(0,t.jsx)(n.code,{children:"app.py"})," (from Dash tutorial)"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# -*- coding: utf-8 -*-\n\n# Run this app with `python app.py` and\n# visit http://127.0.0.1:8050/ in your web browser.\n\nimport dash\nimport dash_core_components as dcc\nimport dash_html_components as html\nimport plotly.express as px\nimport pandas as pd\n\nexternal_stylesheets = [\'https://codepen.io/chriddyp/pen/bWLwgP.css\']\n\napp = dash.Dash(__name__, external_stylesheets=external_stylesheets)\nserver = app.server\n\n# assume you have a "long-form" data frame\n# see https://plotly.com/python/px-arguments/ for more options\ndf = pd.DataFrame({\n    "Fruit": ["Apples", "Oranges", "Bananas", "Apples", "Oranges", "Bananas"],\n    "Amount": [4, 1, 2, 2, 4, 5],\n    "City": ["SF", "SF", "SF", "Montreal", "Montreal", "Montreal"]\n})\n\nfig = px.bar(df, x="Fruit", y="Amount", color="City", barmode="group")\n\napp.layout = html.Div(children=[\n    html.H1(children=\'Hello Dash\'),\n\n    html.Div(children=\'\'\'\n        Dash: A web application framework for Python.\n    \'\'\'),\n\n    dcc.Graph(\n        id=\'example-graph\',\n        figure=fig\n    )\n])\n\nif __name__ == \'__main__\':\n    app.run_server(debug=True)\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a requirements file, eg ",(0,t.jsx)(n.code,{children:"requirements.txt"}),". You can use tools such as ",(0,t.jsx)(n.code,{children:"pipreqs"}),", ",(0,t.jsx)(n.code,{children:"pipenv"})," or other environment managers to help you create the right file."]}),"\n",(0,t.jsxs)(n.li,{children:["Don't forget to add if not present the requirements to ",(0,t.jsx)(n.code,{children:"gunicorn"})," in your requirements file"]}),"\n",(0,t.jsx)(n.li,{children:"Create a Procfile - it's a text file to help Heroku understand what file to be launched on the server. Write in it the following command."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"web: gunicorn app:server\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["As of ",(0,t.jsx)(n.code,{children:"2020-12-01"}),", Dash documentation is not totally correct when it comes to deployment on Heroku, you should correctly link the server variable in Python and the declaration in the ",(0,t.jsx)(n.code,{children:"Procfile"})," :"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Add following line in your app.py script\nserver = app.server\n\n# Write the Procfile\n# - app refer to the file name app.py\n# - server refer to the variable name for the Flask Server \nweb: gunicorn app:server\n"})}),"\n",(0,t.jsx)(n.p,{children:"At the end your repo on Github should look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app.py\nProcfile\nrequirements.txt\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Deploy directly on Heroku from GitHub, you can follow the instructions below"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create a new application\n",(0,t.jsx)(n.img,{src:o(4232).A+"",width:"1739",height:"160"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Find the right name and server region\n",(0,t.jsx)(n.img,{src:o(72631).A+"",width:"969",height:"588"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Link via github, search for your repo and click on connect\n",(0,t.jsx)(n.img,{src:o(8794).A+"",width:"1574",height:"801"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Deploy manually by clicking on deploy and choosing the right github branch\n",(0,t.jsx)(n.img,{src:o(29481).A+"",width:"1353",height:"222"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You can even set up a CI/CD process with auto-deploys by playing with the auto-deploy section\n",(0,t.jsx)(n.img,{src:o(91436).A+"",width:"904",height:"356"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You are all set ! Your app should be live !\n",(0,t.jsx)(n.img,{src:o(86398).A+"",width:"1148",height:"515"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"problems-you-can-encounter",children:"Problems you can encounter"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Having your app not at the root of the repo, you can use subdir buildpack"}),"\n",(0,t.jsx)(n.li,{children:"Not linking correctly your server in the Procfile"}),"\n",(0,t.jsx)(n.li,{children:"Having difficulties to link with a database"}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.mdxAdmonitionTitle,{}),(0,t.jsxs)(n.p,{children:["If your app does not work, you can check in the logs why it failed :\n",(0,t.jsx)(n.img,{src:o(34235).A+"",width:"1574",height:"590"})]})]}),"\n",(0,t.jsx)(n.h4,{id:"what-heroku-is-doing-under-the-hood",children:"What Heroku is doing under the hood"}),"\n",(0,t.jsx)(n.p,{children:"Heroku does a lot for us actually. It detects the technology behind the web server pushed on Heroku (Python, Node, etc...). Looks for a Procfile with instructions on how to launch the server. And knows many things on how to set it up."}),"\n",(0,t.jsxs)(n.p,{children:["For example for Python servers, it will look first to find a ",(0,t.jsx)(n.code,{children:"requirements.txt"})," file or ",(0,t.jsx)(n.code,{children:"pipenv.lock"})," file. For a Node.js server it will look at the ",(0,t.jsx)(n.code,{children:"package.json"})," and the lock file as well."]}),"\n",(0,t.jsx)(n.h3,{id:"deploying-with-docker",children:"Deploying with Docker"}),"\n",(0,t.jsxs)(n.p,{children:["If you want to better master what you are deploying. You may want to use Docker. It's actually universal and you'll be able to deploy it almost anywhere.",(0,t.jsx)("br",{}),'\nI just google searched "Dockerfile Dash" and found a suitable example as a template ',(0,t.jsx)(n.a,{href:"https://github.com/jucyai/docker-dash/blob/master/Dockerfile",children:"https://github.com/jucyai/docker-dash/blob/master/Dockerfile"}),(0,t.jsx)("br",{}),"\nHow does it work? You will setup a virtually empty server with nothing but python 3.9 and the application, i.e a Container."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-docker",children:'FROM python:3.9\n\nENV DASH_DEBUG_MODE True\nCOPY ./app /app\nWORKDIR /app\nRUN set -ex && \\\n    pip install -r requirements.txt\nEXPOSE 8050\nCMD ["python", "app.py"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Using this Dockerfile you could be able to deploy anywhere from GCP to Azure or even Heroku."}),"\n",(0,t.jsx)(n.h2,{id:"going-further",children:"Going further"}),"\n",(0,t.jsx)(n.p,{children:"To better deploy, it's always interesting to learn more about what you are manipulating. Here, you have to know that Dash is a wrapper for other technologies put together, and in particular:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Flask as backend and server"}),"\n",(0,t.jsx)(n.li,{children:"React as frontend"}),"\n",(0,t.jsx)(n.li,{children:"Plotly (the python library) for most graphs"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If you want to be a Deployment ninja \ud83d\udc31\u200d\ud83d\udc64, you may find useful to learn more about Flask and webservers in general. And eventually learn about React."}),"\n",(0,t.jsx)(n.h3,{id:"adding-databases",children:"Adding databases"}),"\n",(0,t.jsx)(n.p,{children:'What is recommended is to avoid storing your database in the same server. You should approach the problem with a "microservice" mindset, meaning that you should put your database on another server.'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Indeed, it means you have to do another deployment, maybe using Docker again to expose your database correctly"}),"\n",(0,t.jsx)(n.li,{children:"But, it also decouple your app in production with the database, allowing you for more modularity (requesting the database in other platforms)"}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},86398:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy7-196c9b1582e3de2f3cb9835fd093a566.jpg"},91436:(e,n,o)=>{o.d(n,{A:()=>i});const i=o.p+"assets/images/deploy5-39060190e5604d2315b16e3faf461ca5.jpg"}}]);