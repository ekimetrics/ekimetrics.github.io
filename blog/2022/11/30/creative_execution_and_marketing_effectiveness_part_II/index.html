<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Eki.Lab Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Eki.Lab Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-124520099-9","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Exploring the links between creative execution and marketing effectiveness - Part II Custom trained Detectron2 for OD | Eki.Lab</title><meta data-react-helmet="true" property="og:title" content="Exploring the links between creative execution and marketing effectiveness - Part II Custom trained Detectron2 for OD | Eki.Lab"><meta data-react-helmet="true" name="description" content="In this Part II we explore the methodology for training Detectron2 models to detect brand-specific object in creative images."><meta data-react-helmet="true" property="og:description" content="In this Part II we explore the methodology for training Detectron2 models to detect brand-specific object in creative images."><meta data-react-helmet="true" property="og:image" content="http://ekimetrics.github.io/img/10-cubecube03.jpg"><meta data-react-helmet="true" name="twitter:image" content="http://ekimetrics.github.io/img/10-cubecube03.jpg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Exploring the links between creative execution and marketing effectiveness - Part II Custom trained Detectron2 for OD | Eki.Lab"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="Data Science,EkiLab,Ekimetrics,Eki.Lab,Eki,Machine Learning,Artificial Intelligence,Data Science for business,Operational Research,Optimization,Knapsack problem,Deep Reinforcement Learning"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/styles.112324ad.css">
<link rel="preload" href="/styles.f71d4296.js" as="script">
<link rel="preload" href="/runtime~main.5e638520.js" as="script">
<link rel="preload" href="/main.a1d44cf5.js" as="script">
<link rel="preload" href="/1.633fe5fc.js" as="script">
<link rel="preload" href="/2.ed921469.js" as="script">
<link rel="preload" href="/167.d6299521.js" as="script">
<link rel="preload" href="/01a85c17.0c2a4368.js" as="script">
<link rel="preload" href="/1be78505.82f54d6f.js" as="script">
<link rel="preload" href="/56ff6114.c8e9d4ed.js" as="script">
<link rel="preload" href="/6875c492.de6e6c0f.js" as="script">
<link rel="preload" href="/a6aa9e1f.aa8b410b.js" as="script">
<link rel="preload" href="/bc11c333.6eb53ebd.js" as="script">
<link rel="preload" href="/c4f5d8e4.c8d58096.js" as="script">
<link rel="preload" href="/ccc49370.9cb3be59.js" as="script">
<link rel="preload" href="/170.45dcc766.js" as="script">
<link rel="preload" href="/ece8ad2d.62181ec0.js" as="script">
<link rel="preload" href="/f9162717.e83a78ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">Eki.Lab</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/">About us</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a href="https://ekimetrics.com/fr/carrieres/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Careers</a></div><div class="navbar__items navbar__items--right"><a href="https://ekimetrics.com/fr/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ekimetrics website</a><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact us!</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Eki.Lab</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/resources/">Resources</a></li><li class="menu__list-item"><a href="https://ekimetrics.com/fr/carrieres/" target="_blank" rel="noopener noreferrer" class="menu__link">Careers</a></li><li class="menu__list-item"><a href="https://ekimetrics.com/fr/" target="_blank" rel="noopener noreferrer" class="menu__link">Ekimetrics website</a></li><li class="menu__list-item"><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="menu__link">Contact us!</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container container-wide margin-vert--lg"><div class="row"><div class="col col--2"></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_kDB-">Exploring the links between creative execution and marketing effectiveness - Part II Custom trained Detectron2 for OD</h1><div class="margin-vert--md"><p>In this Part II we explore the methodology for training Detectron2 models to detect brand-specific object in creative images.</p><time datetime="2022-11-30T00:00:00.000Z" class="blogPostDate_2HVl">November 30, 2022  · 7 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name">Written by <a href="mailto:inno@ekimetrics.com" target="_blank" rel="noreferrer noopener">Marina Bermejo Sarmiento, Monica Brondholt Sorensen, Karin Sasaki</a></h4><small class="avatar__subtitle">Data Scientist Consultant</small></div></div><div class="margin-vert--md"><img class="img-blog-header" src="/./img/blog/Eki_Meta_part_II.png"></div></header><section class="markdown blog-article-custom"><div align="justify"><p>This article is <strong>Part II</strong> of a set of five technical articles that accompany a <a href="https://ekimetrics.com/news-and-events/exploring-the-links-between-creative-execution-and-marketing-effectiveness-exclusivepreview" target="_blank" rel="noopener noreferrer">whitepaper</a> written in collaboration between Meta and Ekimetrics. Object Detection (OD) and Optical Character Recognition (OCR) were used to detect specific features in creative images, such as faces, smiles, text, brand logos, etc. Then, in combination with impressions data, marketing mix models were used to investigate what objects, or combinations of objects in creative images in marketing campaigns, drive higher ROIs.
In this Part II we explore the methodology for training Detectron2 models to detect brand-specific object in creative images.</p></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="why-you-should-read-this"></a>Why you should read this<a class="hash-link" href="#why-you-should-read-this" title="Direct link to heading">#</a></h2><div align="justify">This article is mostly directed to machine learning practitioners. Here you will find a practical application of object detection algorithms; we present different open-source resources, comparisons and trade-offs in model selection for specific objects, methodology to improve performance for custom datasets, and how the object detection is then used to make inferences on the impact of creatives in marketing strategies.</div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dataset"></a>Dataset<a class="hash-link" href="#dataset" title="Direct link to heading">#</a></h2><div align="justify">Our dataset contained &gt;50k image and video creatives across four different brands. The main goal of the custom object detection (OD) was to detect three types of brand-specific objects - logo, product and brand cue - as well as faces and smiles. Initially, faces and smiles were detected by pre-trained algorithms such as Haar cascades and Dlib, but due to the poor performance, it was decided to use a custom algorithm.<p>Before beginning the OD process, videos were converted to images by extracting every tenth frame. Training and Validation sets were then created using the Microsoft Azure Machine Learning Studio labelling tool. The labels were then converted to COCO format, and registered in Detectron as custom COCO libraries. Read more about this in <a href="https://ekimetrics.github.io/blog/2022/11/10/creative_execution_and_marketing_effectiveness_part_I" target="_blank" rel="noopener noreferrer">Part I</a>. </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">## Registering COCO format datasets</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.data.datasets import register_coco_instances</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">register_coco_instances(train, {&#x27;thing_classes&#x27;: train_metadata.thing_classes, &#x27;thing_dataset_id_to_contiguous_id&#x27;: train_metadata.thing_dataset_id_to_contiguous_id}, train_json_path, TRAINING_IMAGES_PATH)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">register_coco_instances(valid, {&#x27;thing_classes&#x27;: valid_metadata.thing_classes, &#x27;thing_dataset_id_to_contiguous_id&#x27;: valid_metadata.thing_dataset_id_to_contiguous_id}, valid_json_path, VALID_IMAGES_PATH)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="algorithm"></a>Algorithm<a class="hash-link" href="#algorithm" title="Direct link to heading">#</a></h2><div align="justify">The Faster Region-based Convolutional Neural Network (R-CNN) model, Faster R-CNN X 101 32x8d FPN 3x, was used for the custom OD model.<p>One model was trained per object per brand using the manually labelled training sets. For detecting faces and smiles, the training set consisted of creatives from all four brands, but each model was developed separately for face and smile per brand. In total there were, thus, 19 custom models. The validation set was used to tune hyperparameters of each model, with accuracy as the main metric. The final models were then used to detect objects in the unlabelled images for all four brands. The training, validation and final detections were all done using a single node GPU (CUDA) on Databricks.</p></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hyperparameter-tuning"></a>Hyperparameter Tuning<a class="hash-link" href="#hyperparameter-tuning" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="process"></a>Process<a class="hash-link" href="#process" title="Direct link to heading">#</a></h3><div align="justify">While Detectron2 allows for the customization of many configurations, including learning rate, backbone, image size, and number of images per batch, we limited the scope to just three parameters due to time constraints. These are summarized in Table 1 along with the parameter values tested. The choice of parameters was based on those deemed to be the most influential in performance. In addition to these parameters, the learning rate – the rate at which the algorithm converges to a solution   – was customized.  Rather than using the default value of 0.001, the learning rate was determined by the linear learning rate scaling rule. This was done in order to facilitate training on larger batch sizes.</div><p> </p><p> <img alt="screenshot-app" src="/assets/images/1-63bf2e1d86f975c672b49017135f6ec8.png"></p><div align="center"> Table 1: Parameters Tested in Custom Models</div><br><p>Example Code</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">## Parameters values to test</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parameters = {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;SOLVER.MAX_ITER&#x27;: [300, 500, 1000],</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;ROI_HEADS.BATCH_SIZE_PER_IMAGE&#x27;: [265, 512, 1024]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">## Configuring the algorithmn</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">def config_detectron(train_dataset, max_iter, batchsize):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    classes = MetadataCatalog.get(train_dataset).thing_classes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    num_classes = len(classes)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    print(f&quot;Number of classes in dataset: {num_classes}&quot;)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg = get_cfg()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.merge_from_file(model_zoo.get_config_file(&quot;COCO-Detection/faster_rcnn_X_101_32x8d_FPN_3x.yaml&quot;))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.DATASETS.TRAIN = (train_dataset, )</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.DATASETS.TEST = ()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.DATALOADER.NUM_WORKERS = 0</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.MODEL.WEIGHTS = model_zoo.get_checkpoint_url(&quot;COCO-Detection/faster_rcnn_X_101_32x8d_FPN_3x.yaml&quot;) # Let training initialize from model zoo</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.SOLVER.IMS_PER_BATCH = 2 ## # How many images per batch? The original models were trained on 8 GPUs with 16 images per batch, since we have 1 GPUs: 16/8 = 2 (we actually have 2 GPUs but we cannot use both as we do not have enough CUDA memory)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.SOLVER.BASE_LR = 0.00125 # We do the same calculation with the learning rate as the GPUs, the original model used 0.01, so we&#x27;ll divide by 8: 0.01/8 = 0.00125. </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.SOLVER.MAX_ITER = max_iter   # How many iterations are we going for? </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.MODEL.ROI_HEADS.BATCH_SIZE_PER_IMAGE = batchsize</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.MODEL.ROI_HEADS.NUM_CLASSES = num_classes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    os.makedirs(cfg.OUTPUT_DIR, exist_ok=True)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    print(dbutils.fs.ls(cfg.OUTPUT_DIR))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return cfg</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">### Training</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">def train_detectron(config):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    trainer = DefaultTrainer(config)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    trainer.resume_or_load(resume=False)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    trainer.train()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return trainer</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div align="justify">Exhaustive Grid Search was used to determine the combination of Max Iterations and Batch Size that yielded the highest accuracy on the validation set for each model. The results were visualized on a heat map, with confidence thresholds of 20%, 40%, 60%, and 80%. An example is shown in Figure 1. In this example, the model with Max Iteration of 1000 and a Batch Size of 265 performed the best, and the results did not improve beyond a confidence threshold of 40%. Confusion Matrices (see example in Figure 2) were also used to gain insight into the False Positive vs. False Negative rate.</div><p> <img alt="screenshot-app" src="/assets/images/3-59df6df54647bdb3ecb7a9625ce33b5c.png"></p><div align="center"> Figure 1 : Example Results of Grid Search</div><br><p> <img alt="screenshot-app" src="/assets/images/4_2-cfad45d3ddbbd7a950805c077bd28cb1.png"></p><div align="center"> Figure 2 : Example Confusion Matrices for Best Performing Model with 80% Confidence Threshold</div><br><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">## Prediction</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">def prediction(config, test_dataset, date_string, threshold):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg = config</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.MODEL.WEIGHTS = f&#x27;/dbfs/mnt/trd/{brand}/objectdetection/custom_output/GPU/{date_string}/model_final.pth&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = threshold # set the testing threshold for this model</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    cfg.DATASETS.TEST = (test_dataset, )</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    predictor = DefaultPredictor(cfg)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return predictor</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">def evaluation(config, test_dataset, trainer):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Setup an evaluator, we use COCO because it&#x27;s one of the standards for object detection: https://detectron2.readthedocs.io/modules/evaluation.html#detectron2.evaluation.COCOEvaluator</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    evaluator = COCOEvaluator(dataset_name=test_dataset, </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                              cfg=config, </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                              distributed=False, </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                              output_dir=&quot;./output/&quot;)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Create a dataloader to load in the test data (cmaker-fireplace-valid)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    val_loader = build_detection_test_loader(config, </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                             dataset_name=test_dataset)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Make inference on the validation dataset: https://detectron2.readthedocs.io/tutorials/evaluation.html</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    inference = inference_on_dataset(model=trainer, # get the model from the trainer</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                         data_loader=val_loader, </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                         evaluator=evaluator)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return inference</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">## Make Predictions</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">def get_predictions(predictor, imagePath):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Get predictions</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.imread(imagePath)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    predictions = predictor(image)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    instances = predictions[&quot;instances&quot;]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    class_indexes = instances.pred_classes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    prediction_boxes = instances.pred_boxes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    class_catalog = valid_metadata.thing_classes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    class_labels = [class_catalog[i] for i in class_indexes] </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    class_scores = instances.scores</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return class_indexes, prediction_boxes, class_labels, class_scores</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="results"></a>Results<a class="hash-link" href="#results" title="Direct link to heading">#</a></h3><div align="justify">The best performing model was then used to determine the optimal threshold for each object type, at 1% intervals ranging from 20% to 99%. The threshold yielding the highest accuracy for each object class per model was then selected. The results are summarized in Table 2. Following these results, the best custom-trained model per object per brand was used to detect object in the unlabelled dataset in batches of 200 creatives. This was done in order to limit the CUDA memory and ensure that work was saved along the way should something happen. The total detection time for each brand ranged between 72-168 hours.</div><p> </p><p><img alt="screenshot-app" src="/assets/images/2-2d2d4dac8274023a1627443f50d359e9.png"></p><div align="center"> Table 2: Final Custom Models</div><br><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="useful-links"></a>Useful links<a class="hash-link" href="#useful-links" title="Direct link to heading">#</a></h3><ul><li><a href="https://github.com/facebookresearch/detectron2" target="_blank" rel="noopener noreferrer">Detectron2 - Github</a></li><li><a href="https://detectron2.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Detectron2 - Documentation</a></li><li><a href="https://github.com/facebookresearch/detectron2/blob/main/MODEL_ZOO.md" target="_blank" rel="noopener noreferrer">Detectron2 - ModelZoo</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="other-useful-code"></a>Other useful code<a class="hash-link" href="#other-useful-code" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="imports"></a>Imports<a class="hash-link" href="#imports" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Install Detectron2 dependencies: https://detectron2.readthedocs.io/tutorials/install.html (use cu100 because colab is on CUDA 10.0)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip install -U torch==1.4+cu100 torchvision==0.5+cu100 -f https://download.pytorch.org/whl/torch_stable.html </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip install cython pyyaml==5.1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip install -U &#x27;git+https://github.com/cocodataset/cocoapi.git#subdirectory=PythonAPI&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip install awscli # you&#x27;ll need this if you want to download images from Open Images (we&#x27;ll see this later)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Make sure we can import PyTorch (what Detectron2 is built with)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">import torch, torchvision</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">torch.__version__</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!gcc --version</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip install detectron2 -f https://dl.fbaipublicfiles.com/detectron2/wheels/cu100/index.html</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Setup detectron2 logger</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">import detectron2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.utils.logger import setup_logger</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">setup_logger() # this logs Detectron2 information such as what the model is doing when it&#x27;s training# import some common detectron2 utilities</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Other detectron2 imports</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.engine import DefaultTrainer</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.evaluation import COCOEvaluator, inference_on_dataset</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.data import build_detection_test_loader</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2 import model_zoo </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.engine import DefaultPredictor </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.config import get_cfg</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.utils.visualizer import Visualizer </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from detectron2.data import MetadataCatalog </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="next-article"></a>Next article<a class="hash-link" href="#next-article" title="Direct link to heading">#</a></h2><p>In the next article, we will showcase Tesseract, a open-source optical character recognition (OCR) Engine, and the image-processing methods we developed to raise the baseline performance of this library, from 68% accuracy, by up to 28 percentage points.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/object-detection">Object Detection</a><a class="margin-horiz--sm" href="/blog/tags/optical-character-recognition">Optical Character Recognition</a><a class="margin-horiz--sm" href="/blog/tags/marketing-mix-modelling">Marketing Mix Modelling</a><a class="margin-horiz--sm" href="/blog/tags/deep-learning">Deep Learning</a><a class="margin-horiz--sm" href="/blog/tags/tesseract">Tesseract</a></div></footer></article><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/12/13/creative_execution_and_marketing_effectiveness_part_III"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Exploring the links between creative execution and marketing effectiveness - Part III: Tesseract Pre-Trained Optical Character Recognition Models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/11/10/creative_execution_and_marketing_effectiveness_part_I"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Exploring the links between creative execution and marketing effectiveness - Part I: Detectron2 Pre-Trained Object Detection Models »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-you-should-read-this" class="table-of-contents__link">Why you should read this</a></li><li><a href="#dataset" class="table-of-contents__link">Dataset</a></li><li><a href="#algorithm" class="table-of-contents__link">Algorithm</a></li><li><a href="#hyperparameter-tuning" class="table-of-contents__link">Hyperparameter Tuning</a><ul><li><a href="#process" class="table-of-contents__link">Process</a></li><li><a href="#results" class="table-of-contents__link">Results</a></li><li><a href="#useful-links" class="table-of-contents__link">Useful links</a></li><li><a href="#other-useful-code" class="table-of-contents__link">Other useful code</a></li></ul></li><li><a href="#next-article" class="table-of-contents__link">Next article</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">About us</h4><ul class="footer__items"><li class="footer__item"><a href="https://ekimetrics.com/who-we-are/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Who we are ?</a></li><li class="footer__item"><a href="https://ekimetrics.com/our-team/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Our team</a></li><li class="footer__item"><a href="https://ekimetrics.us13.list-manage.com/subscribe?u=85b8ce42caa0a733e98233bc4&amp;id=6355d0a6f9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subscribe to our newsletter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Find us</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ekimetrics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://ekimetrics.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://www.welcometothejungle.com/fr/companies/ekimetrics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Eki on Welcome to the jungle</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Get in touch with our teams</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/styles.f71d4296.js"></script>
<script src="/runtime~main.5e638520.js"></script>
<script src="/main.a1d44cf5.js"></script>
<script src="/1.633fe5fc.js"></script>
<script src="/2.ed921469.js"></script>
<script src="/167.d6299521.js"></script>
<script src="/01a85c17.0c2a4368.js"></script>
<script src="/1be78505.82f54d6f.js"></script>
<script src="/56ff6114.c8e9d4ed.js"></script>
<script src="/6875c492.de6e6c0f.js"></script>
<script src="/a6aa9e1f.aa8b410b.js"></script>
<script src="/bc11c333.6eb53ebd.js"></script>
<script src="/c4f5d8e4.c8d58096.js"></script>
<script src="/ccc49370.9cb3be59.js"></script>
<script src="/170.45dcc766.js"></script>
<script src="/ece8ad2d.62181ec0.js"></script>
<script src="/f9162717.e83a78ca.js"></script>
</body>
</html>