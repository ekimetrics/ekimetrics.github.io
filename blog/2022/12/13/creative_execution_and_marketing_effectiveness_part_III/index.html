<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Eki.Lab Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Eki.Lab Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-124520099-9","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Exploring the links between creative execution and marketing effectiveness - Part III: Tesseract Pre-Trained Optical Character Recognition Models | Eki.Lab</title><meta data-react-helmet="true" property="og:title" content="Exploring the links between creative execution and marketing effectiveness - Part III: Tesseract Pre-Trained Optical Character Recognition Models | Eki.Lab"><meta data-react-helmet="true" name="description" content="In this Part III we explore the methodology for using Tesseract to detect text in creative images."><meta data-react-helmet="true" property="og:description" content="In this Part III we explore the methodology for using Tesseract to detect text in creative images."><meta data-react-helmet="true" property="og:image" content="http://ekimetrics.github.io/img/10-cubecube03.jpg"><meta data-react-helmet="true" name="twitter:image" content="http://ekimetrics.github.io/img/10-cubecube03.jpg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Exploring the links between creative execution and marketing effectiveness - Part III: Tesseract Pre-Trained Optical Character Recognition Models | Eki.Lab"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="Data Science,EkiLab,Ekimetrics,Eki.Lab,Eki,Machine Learning,Artificial Intelligence,Data Science for business,Operational Research,Optimization,Knapsack problem,Deep Reinforcement Learning"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/styles.112324ad.css">
<link rel="preload" href="/styles.89717982.js" as="script">
<link rel="preload" href="/runtime~main.f8fae7c0.js" as="script">
<link rel="preload" href="/main.d2eb4b1a.js" as="script">
<link rel="preload" href="/1.94dfeea1.js" as="script">
<link rel="preload" href="/2.4707930d.js" as="script">
<link rel="preload" href="/159.23443c64.js" as="script">
<link rel="preload" href="/01a85c17.1953debb.js" as="script">
<link rel="preload" href="/1be78505.f0a58be5.js" as="script">
<link rel="preload" href="/56ff6114.9c2e10f2.js" as="script">
<link rel="preload" href="/6875c492.24668494.js" as="script">
<link rel="preload" href="/a6aa9e1f.a3ce550b.js" as="script">
<link rel="preload" href="/bc11c333.4019769d.js" as="script">
<link rel="preload" href="/c4f5d8e4.8205ea96.js" as="script">
<link rel="preload" href="/ccc49370.08c817b4.js" as="script">
<link rel="preload" href="/162.b0cb2e8d.js" as="script">
<link rel="preload" href="/ece8ad2d.14a32f00.js" as="script">
<link rel="preload" href="/aa8ef866.322f3331.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">Eki.Lab</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/">About us</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a href="https://ekimetrics.com/fr/carrieres/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Careers</a></div><div class="navbar__items navbar__items--right"><a href="https://ekimetrics.com/fr/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ekimetrics website</a><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact us!</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Eki.Lab</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/resources/">Resources</a></li><li class="menu__list-item"><a href="https://ekimetrics.com/fr/carrieres/" target="_blank" rel="noopener noreferrer" class="menu__link">Careers</a></li><li class="menu__list-item"><a href="https://ekimetrics.com/fr/" target="_blank" rel="noopener noreferrer" class="menu__link">Ekimetrics website</a></li><li class="menu__list-item"><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="menu__link">Contact us!</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container container-wide margin-vert--lg"><div class="row"><div class="col col--2"></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_kDB-">Exploring the links between creative execution and marketing effectiveness - Part III: Tesseract Pre-Trained Optical Character Recognition Models</h1><div class="margin-vert--md"><p>In this Part III we explore the methodology for using Tesseract to detect text in creative images.</p><time datetime="2022-12-13T00:00:00.000Z" class="blogPostDate_2HVl">December 13, 2022  · 8 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name">Written by <a href="mailto:inno@ekimetrics.com" target="_blank" rel="noreferrer noopener">Marina Bermejo Sarmiento, Monica Brondholt Sorensen, Karin Sasaki</a></h4><small class="avatar__subtitle">Data Scientist Consultant</small></div></div><div class="margin-vert--md"><img class="img-blog-header" src="/./img/blog/Eki_Meta_part_III.png"></div></header><section class="markdown blog-article-custom"><div align="justify"><p>This article is <strong>Part III</strong> of a set of five technical articles that accompany a <a href="https://ekimetrics.com/news-and-events/exploring-the-links-between-creative-execution-and-marketing-effectiveness-exclusivepreview" target="_blank" rel="noopener noreferrer">whitepaper</a> written in collaboration between Meta and Ekimetrics. Object Detection (OD) and Optical Character Recognition (OCR) were used to detect specific features in creative images, such as faces, smiles, text, brand logos, etc. Then, in combination with impressions data, marketing mix models were used to investigate what objects, or combinations of objects in creative images in marketing campaigns, drive higher ROIs.
In this Part III we explore the methodology for using Tesseract to detect text in creative images.</p></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="detecting-text-with-tesseract"></a>Detecting Text with Tesseract<a class="hash-link" href="#detecting-text-with-tesseract" title="Direct link to heading">#</a></h2><div align="justify">Tesseract is an open-source optical character recognition (OCR) Engine that allows for the recognition of text characters within a digital image. It is an open-source resource, originally developed by Hewlett-Packard, and now managed by Google. This package does not have any parameters to optimise, but, as is exposed here, the basic performance of this resource can be improved with a combination of image processing and detected text correction.<p>In this work, Tesseract was used to detect text in all images, in a process outlined in Figure 1. Performance of this detection tool was done using Confusion Matrices, to gain insight not only into the Accuracy, but also other metrics such as the True Positive and True Negative Rates.  </p></div><p><img alt="screenshot-app" src="/assets/images/10-dc93d16eaa104bf23fe228afaf7bd6a2.PNG"></p><div align="center"> Figure 1 - Three stage process by which the basic performance (accuracy) of Tesseract on the original images was improved by up to 28% points.</div><br><div align="justify">To start with, the functionality was used on the original images to measure a baseline for performance on our sets of images. From this first step, we derived the following learnings:<ul><li>For general Text (both non-promotional Text and Promotional Text), the Accuracy is 69%, the True Positive Rate is around 65%, the False Positive Rate is about 35%.</li><li>Tesseract does not recognise symbols such as % (which may indicate promotional text) accurately.</li><li>Tesseract does not perform well on images that have a busy background.</li><li>Tesseract does not recognise slanted Text.</li></ul><p>Based on the low total volume of Promotional Text in our dataset, as well as the poor performance of Tesseract to detect Promotional Text, the decision was made to remove Promotional Text as one of the desired objects to study.</p><p>Building on those learnings, we implemented a pipeline, outlined in Figure 2, that would help us improve the performance from baseline, by up to 28 percentage points on Accuracy : </p></div><p><img alt="screenshot-app" src="/assets/images/11-435bc20c4e2284716dcd7b9565a42098.PNG"></p><div align="center"> Figure 2 - Pipeline for pre-processing images before Optical Character Recognition Models, and correcting detected text.</div><br><div align="justify"><p>For Step 1, pre-processing methods included the following, as well as combinations of those (illustrated in Figure 3): <strong>Binary Threshold, Sharpen, Normalisation, Histogram Equalisation, Histogram Adaptive Equalisation</strong>. As can be imagined, a processing method that enhances the performance of the detection method for one image, might decrease it for different images. Therefore, to ensure we obtained the highest accuracy for all images, we applied all pre-processing methods to all images, running Tesseract on each modified image, and keeping track of the text detected in each iteration. </p></div><p> <img alt="screenshot-app" src="/assets/images/12-bdf7d0b4655f39b30eaa56e906ef8e6d.PNG"></p><div align="center"> Figure 3 - Effect of various image processing methods on the original. Images for illustrative purposes. Original images sourced from <a href="https://unsplash.com/s/photos/coca-cola" target="_top" rel="noopener noreferrer">unsplash.com</a></div><br><div align="justify">In Step 2 we use Tesseract to detect text in the pre-processed images. Step 3 consisted of removing any “incorrect” text, such as text inside the bounding boxes of Logo or Product objects, if the text was shorter than a threshold length (which depended on the brand), if it consisted of keywords, such as the brand name, or if it had ASCII characters.<p>With the current methodology (figure 2), the accuracy cannot be improved any further by changing the length of text that is considered to be “true” Text. Furthermore, there is a trade-off between the True Negative Rate and the True Positive Rate, which helped us choose a threshold for the length of string to accept: Since Accuracy does not improve further after length 4, but this value does optimise the other two metrics, 4 characters long is the threshold chosen. </p></div><br><div align="justify">The performance of Tesseract may be improved further by adding another step to the pipeline in figure 2, where the image is rotated several degrees, and after each rotation, text is detected. Due to time constraint issues, and the fact that we had already achieved a significant improvement above baseline and reached an accuracy of high 90s for some of the brands, we did not implement this step.</div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="code-snippets"></a>Code snippets<a class="hash-link" href="#code-snippets" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="install-required-libraries"></a>Install required libraries<a class="hash-link" href="#install-required-libraries" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"># To install tesseract</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># !sh apt-get -f -y install tesseract-ocr </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!sudo apt-get install tesseract-ocr -y</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># To install pytesseract</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">!pip3 install pytesseract</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="import-required-libraries"></a>Import required libraries<a class="hash-link" href="#import-required-libraries" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">import pytesseract</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from sklearn.metrics import confusion_matrix, accuracy_score</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">import cv2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">from PIL import Image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="processing-images"></a>Processing images<a class="hash-link" href="#processing-images" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def normalise_img(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # normalise original and detect</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    norm_img = np.zeros((image.shape[0], image.shape[1]))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    normalised = cv2.normalize(image, norm_img, 0, 255, cv2.NORM_MINMAX)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    normalised = cv2.threshold(normalised, 100, 255, cv2.THRESH_BINARY)[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    normalised = cv2.GaussianBlur(normalised, (1, 1), 0)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return normalised</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def threshold_image(image, threshold=200):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.threshold(image, threshold, 255, cv2.THRESH_BINARY)[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def remove_noise_and_smooth(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # convert to grayscale</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # blur</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    blur = cv2.GaussianBlur(gray, (0,0), sigmaX=33, sigmaY=33)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # divide</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    divide = cv2.divide(gray, blur, scale=255)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # otsu threshold</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    thresh = cv2.threshold(divide, 0, 255, cv2.THRESH_BINARY+cv2.THRESH_OTSU)[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # apply morphology</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (3,3))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    morph = cv2.morphologyEx(thresh, cv2.MORPH_CLOSE, kernel)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return morph</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_to_gray(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # convert to grayscale </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return gray</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def create_binary(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # create binary - converting a colored image (RGB) into a black and white image - Adaptive binarization works based on the features of neighboring pixels (i.e) local window.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    binary = cv2.threshold(image ,130,255,cv2.THRESH_BINARY + cv2.THRESH_OTSU)[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return binary</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def hist_equaliser(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Image Contrast and Sharpness: histogram equalization</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    equalised = cv2.equalizeHist(gray)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return equalised</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def adaptive_hist_equaliser(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Image Contrast and Sharpness: adaptive histogram equalization</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8, 8))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    equalised = clahe.apply(gray)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return equalised</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def invert_image():</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # invert the image - Color Inversion when different regions have different Foreground and Background colors</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    inverted = cv2.bitwise_not(image)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return inverted</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_blur(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Blurring or Smoothing </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    averageBlur = cv2.blur(image, (5, 5))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_gaussianBlur(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Blurring or Smoothing (Gaussian Blur)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    gaussian = cv2.GaussianBlur(image, (3, 3), 0)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_medianBlur(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Blurring or Smoothing (Median Blur (good at removing salt and pepper noises))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    medianBlur = cv2.medianBlur(image, 9)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_bilateralBlur(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # Blurring or Smoothing (Bilateral Filtering)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    bilateral = cv2.bilateralFilter(image, 9, 75, 75)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def unsharp_mask(image, kernel_size=(5, 5), sigma=1.0, amount=1.0, threshold=0):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;Return a sharpened version of the image, using an unsharp mask.&quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    blurred = cv2.GaussianBlur(image, kernel_size, sigma)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    sharpened = float(amount + 1) * image - float(amount) * blurred</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    sharpened = np.maximum(sharpened, np.zeros(sharpened.shape))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    sharpened = np.minimum(sharpened, 255 * np.ones(sharpened.shape))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    sharpened = sharpened.round().astype(np.uint8)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    if threshold &gt; 0:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        low_contrast_mask = np.absolute(image - blurred) &lt; threshold</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        np.copyto(sharpened, image, where=low_contrast_mask)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return sharpened</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def apply_filter_sharpen(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    kernel = np.array([[-1,-1,-1], [-1,9,-1], [-1,-1,-1]])</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.filter2D(image, -1, kernel)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def im_erode_dilate(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # apply noise reduction techniques like eroding, dilating</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    kernel = np.ones((2,2),np.uint8)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.erode(image, kernel, iterations = 1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.dilate(image, kernel, iterations = 1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def process_image(image):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    Example of a pipeline to pre-process an image.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # convert to grayscale </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">     # create binary</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.threshold(image ,130,255,cv2.THRESH_BINARY + cv2.THRESH_OTSU)[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # invert the image</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.bitwise_not(image)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    # apply noise reduction techniques like eroding, dilating</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    kernel = np.ones((2,2),np.uint8)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.erode(image, kernel, iterations = 1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    image = cv2.dilate(image, kernel, iterations = 1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return image</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="detect-text"></a>Detect text<a class="hash-link" href="#detect-text" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def detect_text(image, brand_name, t, bboxes_file, verbose=True):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data = pytesseract.image_to_data(image, output_type=pytesseract.Output.DICT)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    bboxes = get_bbox_pts(data)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data_out, bboxess, tt = check_text_ok(data, brand_name)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return data, bboxes</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="manipulate-bounding-boxes"></a>Manipulate bounding boxes<a class="hash-link" href="#manipulate-bounding-boxes" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def get_bbox_pts(data):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    From the output of the text detection model, extract the [x1,x2,y1,y2] points.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data[&#x27;x1&#x27;] = []</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data[&#x27;x2&#x27;] = []</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data[&#x27;y1&#x27;] = []</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    data[&#x27;y2&#x27;] = []</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    for i, txt in enumerate(data[&#x27;text&#x27;]):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        # extract the width, height, top and left position for that detected word</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        w = data[&quot;width&quot;][i]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        h = data[&quot;height&quot;][i]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        l = data[&quot;left&quot;][i]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        t = data[&quot;top&quot;][i]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        # define all the surrounding box points</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        x1 = l</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        x2 = l + w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        y1 = t</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        y2 = t + h</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        data[&#x27;x1&#x27;].append(x1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        data[&#x27;x2&#x27;].append(x2)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        data[&#x27;y1&#x27;].append(y1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        data[&#x27;y2&#x27;].append(y2)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">def transform_bbox(bbox):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    Transform Azure labels of valid set from [x,y,w,h] (in absolute numbers, prev. transformed) to [x,y,x1,y1].</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    x = bbox[0]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    y = bbox[1]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    w = bbox[2]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    h = bbox[3]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    x1 = x + w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    y1 = y + h</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return [x,y,x1,y1]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="useful-links"></a>Useful Links<a class="hash-link" href="#useful-links" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/tesseract-ocr" target="_blank" rel="noopener noreferrer">Tesseract - Github</a></li><li><a href="https://tesseract-ocr.github.io/tessdoc/Home.html" target="_blank" rel="noopener noreferrer">Tesseract - User Manual</a></li><li><a href="https://pypi.org/project/pytesseract/" target="_blank" rel="noopener noreferrer">Pytesseract - Pypi</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="next-article"></a>Next article<a class="hash-link" href="#next-article" title="Direct link to heading">#</a></h2><p>In the next article, we outline the MMM process, focusing on how the creative elements are used as variables in a multivariate regression, as well as how the final ROIs were calculated.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/object-detection">Object Detection</a><a class="margin-horiz--sm" href="/blog/tags/optical-character-recognition">Optical Character Recognition</a><a class="margin-horiz--sm" href="/blog/tags/marketing-mix-modelling">Marketing Mix Modelling</a><a class="margin-horiz--sm" href="/blog/tags/deep-learning">Deep Learning</a><a class="margin-horiz--sm" href="/blog/tags/tesseract">Tesseract</a></div></footer></article><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2023/01/15/creative_execution_and_marketing_effectiveness_part_IV"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Exploring the links between creative execution and marketing effectiveness - Part IV: MMM for Creative Marketing Effectiveness</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/11/30/creative_execution_and_marketing_effectiveness_part_II"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Exploring the links between creative execution and marketing effectiveness - Part II Custom trained Detectron2 for OD »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#detecting-text-with-tesseract" class="table-of-contents__link">Detecting Text with Tesseract</a></li><li><a href="#code-snippets" class="table-of-contents__link">Code snippets</a><ul><li><a href="#install-required-libraries" class="table-of-contents__link">Install required libraries</a></li><li><a href="#import-required-libraries" class="table-of-contents__link">Import required libraries</a></li><li><a href="#processing-images" class="table-of-contents__link">Processing images</a></li><li><a href="#detect-text" class="table-of-contents__link">Detect text</a></li><li><a href="#manipulate-bounding-boxes" class="table-of-contents__link">Manipulate bounding boxes</a></li></ul></li><li><a href="#useful-links" class="table-of-contents__link">Useful Links</a></li><li><a href="#next-article" class="table-of-contents__link">Next article</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">About us</h4><ul class="footer__items"><li class="footer__item"><a href="https://ekimetrics.com/who-we-are/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Who we are ?</a></li><li class="footer__item"><a href="https://ekimetrics.com/our-team/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Our team</a></li><li class="footer__item"><a href="https://ekimetrics.us13.list-manage.com/subscribe?u=85b8ce42caa0a733e98233bc4&amp;id=6355d0a6f9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subscribe to our newsletter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Find us</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ekimetrics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://ekimetrics.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://www.welcometothejungle.com/fr/companies/ekimetrics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Eki on Welcome to the jungle</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:inno@ekimetrics.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Get in touch with our teams</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/styles.89717982.js"></script>
<script src="/runtime~main.f8fae7c0.js"></script>
<script src="/main.d2eb4b1a.js"></script>
<script src="/1.94dfeea1.js"></script>
<script src="/2.4707930d.js"></script>
<script src="/159.23443c64.js"></script>
<script src="/01a85c17.1953debb.js"></script>
<script src="/1be78505.f0a58be5.js"></script>
<script src="/56ff6114.9c2e10f2.js"></script>
<script src="/6875c492.24668494.js"></script>
<script src="/a6aa9e1f.a3ce550b.js"></script>
<script src="/bc11c333.4019769d.js"></script>
<script src="/c4f5d8e4.8205ea96.js"></script>
<script src="/ccc49370.08c817b4.js"></script>
<script src="/162.b0cb2e8d.js"></script>
<script src="/ece8ad2d.14a32f00.js"></script>
<script src="/aa8ef866.322f3331.js"></script>
</body>
</html>